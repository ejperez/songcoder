(function(t){t(document).ready(function(){var e=t("#songForm");var r=t("#source");var s=t("#newKey");var l=new Song;var i=new Printer;var a=t("#previewContainer");var n=function(){l.parse(r.val(),s.val());return i.render(l)};e.on("submit",function(t){t.preventDefault();var e=n();var r=window.open();r.document.write(e);r.document.close()})})})(jQuery);function Printer(){this.render=function(t){var e='<span class="dot">.</span>';var r={"[[:":"{","[[":'"',"[[_":"V"};var s={1:"w",2:"h",4:"q",8:"e",16:"s","1.":"R","2.":"d","4.":"j","8.":"i","16.":"s"+e,"1_":"wU","2_":"hU","4_":"qU","8_":"eU","16_":"sU","1._":"RU","2._":"dU","4._":"jU","8._":"iU","16._":"s"+e+"U"};var l={1:"W",2:"H",4:"Q",8:"E",16:"S","1.":"W"+e,"2.":"D","4.":"J","8.":"I","16.":"S"+e,"1_":"WU","2_":"HU","4_":"QU","8_":"EU","16_":"SU","1._":"W"+e+"U","2._":"DU","4._":"JU","8._":"IU","16._":"S"+e+"U"};var i={"16,16,8":"M","16,16":"N","16,8.":"O","8_3":"T","8,8,8,8":"Y","8,16,16":"m","8,8":"n","8.,16":"o","4_3":"t","16,16,16,16":"y","8,8,8":"§","16,16,16":"³","16,8,16":"¾"};var a='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8">';a+="<title>"+t.title+" by "+t.artists+"</title>";a+='<link rel="stylesheet" href="dist/css/print.min.css"/>';a+='<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">';a+="</head>";a+="<body>";a+='<table cellspacing="0" id="header" class="full-width">';a+="<tr>";a+='<td colspan="4" style="width: 100%;border-bottom:solid thin black">';a+='<h2 id="title">'+t.title+" - "+t.artists+"</h2>";a+="</td>";a+="</tr>";a+="<tr>";a+='<td width="12%">Tempo: '+t.bpm+"</td>";a+='<td width="12%">Meter: '+t.meter+"</td>";a+='<td width="10%">Key: '+t.key+"</td>";a+='<td width="56%">'+t.comment+"</td>";a+="</tr></table>";t.body.lines.forEach(function(e,n){a+='<table cellspacing="0" border="0" style="padding-top: '+(e.hasLabels?"15":"10")+'px">';a+="<tbody>";a+="<tr>";var o=false;e.bars.forEach(function(f,d){a+='<td style="vertical-align: top; padding-right: 5px;">';a+='<table cellspacing="0" border="0" class="full-width">';a+="<tbody>";if(e.hasLabels){a+="<tr>";if(f.hasOwnProperty("left_label")){a+='<td colspan="3"><span style="font-weight: bold">'+f.left_label+"</span></td>"}else if(f.hasOwnProperty("right_label")){a+='<td colspan="3" class="right">'+f.right_label+"</td>"}else{a+='<td colspan="3">&nbsp;</td>'}a+="</tr>"}if(e.hasComments){a+="<tr>";if(f.hasOwnProperty("left_comment")){a+='<td colspan="3" class="comment">'+f.left_comment+"</td>"}else if(f.hasOwnProperty("right_comment")){a+='<td colspan="3" class="right comment">'+f.right_comment+"</td>"}else{a+='<td colspan="3" class="comment">&nbsp;</td>'}a+="</tr>"}a+="<tr>";if(f.hasOwnProperty("before")){a+='<td class="bar-line">'+r[f.before]+"</td>"}else{if(o){o=false}else{a+='<td class="bar-line">\\</td>'}}a+="<td>";a+='<table cellspacing="0" border="0" width="100%">';a+="<tbody>";a+="<tr>";f.items.forEach(function(t){a+='<td style="padding-right: 5px;">';a+='<table cellspacing="0" border="0">';a+="<tbody>";if(t.chord!=="r"){a+="<tr>";a+='<td class="chord">'+(t.chord==="x"?"&nbsp;":t.chord)+"</td>";a+="</tr>"}a+="<tr>";var e="";if(t.hasOwnProperty("timing")){if(t.chord!=="r"&&i.hasOwnProperty(t.timing)){e+=i[t.timing]}else{var r=t.timing.split(",");r.forEach(function(r){if(t.chord==="r"){if(l.hasOwnProperty(r)){e+=l[r]}}else{if(s.hasOwnProperty(r)){e+=s[r]}}})}}else{if(t.chord==="r"){e="W"}}if(e!==""){a+='<td class="chord-timing" border="1">'+e+"</td>"}a+="</tr>";a+="</tbody>";a+="</table>";a+="</td>"});a+="</tr>";a+="</tbody>";a+="</table>";a+="</td>";if(f.hasOwnProperty("after")){if(f.after.substr(0,3)===":]]"){o=true;if(f.after.length>3){var c=f.after.substr(3);a+='<td class="bar-line bar-line-after" style="width: 60px;">}<span style="font-family: Arial; font-size: 12pt"> x '+c+"</span></td>"}else{a+='<td class="bar-line bar-line-after">}</td>'}}}else if(d===e.bars.length-1){if(n===t.body.lines-1){a+='<td class="bar-line bar-line-after">]</td>'}else{a+='<td class="bar-line bar-line-after">\\</td>'}}a+="</tr>";a+="</tbody>";a+="</table>";a+="</td>"});a+="</tr>";a+="</tbody>";a+="</table>"});a+="</body></html>";return a}}function Song(){this.title=null;this.artists=null;this.key=null;this.comment=null;this.bpm=null;this.meter=null;this.body=null;var t=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];var r=["C","D","E","F","G","A","B"];var s=["F","Bb","Eb","Ab","Db","Gb"];String.prototype.replaceAll=function(t,e){return this.split(t).join(e)};var l=function(r,s,l){var i=e.indexOf(r);if(i===-1){i=t.indexOf(r)}var a=i+s;if(a<0){a=e.length+a}else if(a>=e.length){a=a-e.length}if(l){return t[a]}else{return e[a]}};var i=function(t,e,s){if(t==="r")return t;var i=t.substr(0,1);if(r.indexOf(i)===-1){return t}var a=null;if(t.substr(1,1)==="#"){i+="#";a=t.substr(2)}else if(t.substr(1,1)==="b"){i+="b";a=t.substr(2)}else{a=t.substr(1)}i=l(i,e,s);t=i+a;if(t.indexOf("/")>-1){var n=t.substr(t.indexOf("/")+1);t=t.substr(0,t.indexOf("/"))+"/"+l(n,e,s)}return t};this.parse=function(r,a){var n=this;var o=r.trim().split(/\s*[\r\n]+\s*/g);if(o.length>0){o.forEach(function(t,e){if(e<7){var r=t.split(":");n[r[0]]=r[1]}else{n.body+=t+"\r\n"}})}var f=e.indexOf(n.key);if(f===-1){f=t.indexOf(n.key)}if(a===""){a=n.key}var d=e.indexOf(a);if(d===-1){d=t.indexOf(a)}var c=d-f;var b=s.indexOf(a)>-1;if(c!==0||b){n.key=l(n.key,c,b)}var h=n.body.trim().split(/\s*[\r\n]+\s*/g);var p={lines:[]};h.forEach(function(t){if(t==="v2"||t==="")return;var e=t.trim();var r={bars:[],hasComments:false,hasLabels:false};var l=false;var a=false;var n=e.split("|");n.forEach(function(t){var e={items:[]};var n=t.split(" ");n.forEach(function(t){if(t==="")return;var r=t.substr(0,1);var n=t.substr(t.length-1,1);if(r==="["&&n==="]"){var o=t.substr(1).substr(0,t.length-2).replaceAll("_"," ");if(t.substr(0,1)==="'"){e.left_label=o.replaceAll("'","")}else if(t.substr(0,1)==='"'){e.right_label=o.replaceAll('"',"")}else{e.left_label=o}l=true}else if(t==="[[:"||t==="[["||t==="[[_"){e.before=t}else if(t.substr(0,2)==="[["){var f=t.substr(2);b=s.indexOf(f)>-1}else if(t.substr(0,3)===":]]"){e.after=t}else if(r==="'"){e.left_comment=t.replaceAll("'","").replaceAll("_"," ");a=true}else if(r==='"'){e.right_comment=t.replaceAll('"',"").replaceAll("_"," ");a=true}else{if(t.indexOf(":")===-1){if(c!==0||b){e.items.push({chord:i(t,c,b)})}else{e.items.push({chord:t})}}else{var d=t.split(":");if(c!==0||b){e.items.push({chord:i(d[0],c,b),timing:d[1]})}else{e.items.push({chord:d[0],timing:d[1]})}}}});r.bars.push(e);r.hasComments=a;r.hasLabels=l});p.lines.push(r)});n.body=p}}
